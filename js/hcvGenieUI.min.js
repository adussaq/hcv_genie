!function(){"use strict";var e,t,n,a,i,o,r,d,s,l,p,c,h=jQuery,g=!1,m=!1,u=[];l=h("#textResults"),p=h("#imageResults"),c=h("#drop"),e=function(){var e=Math.round(19*Math.random()+1);hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:"./dataExamples/pages/samples1-20_page"+e+".pdf",scale:2.25}}).then(t)},n=function(e){return function(e){var t,n,a;return n=Math.random().toString(12).replace("0.",""),a=Math.random().toString(12).replace("0.",""),t='<input id="'+n+'" type="text" class="form-control" value="'+e.map(function(e){return e.call}).join(", ")+'">',{string:t,form_id:n,genotype_id:a}}(e)},a=function(e){return function(t){var n,a;t.preventDefault(),n=h("#"+e.form_id).val(),n.match(/^[\s,\d]+$/)&&(a=n.split(/,/),hcvGenie.genotype(a).then(function(t){console.log(t),h("#"+e.genotype_id).text(t)}))}},t=function(e){r({canvas:h(e.canvas),all:!0}),u=[],e.bandLocationPromise.then(function(t){var i,o,d,s;for(console.log("here",t.lanes,t.region),r({canvas:h(e.canvas),all:!1,region:t.region}),o=h('<table class="table table-hover" style="width:100%">'),o.appendTo(l),o.append(h('<tr><th style="width:10%">Lane</th><th style="width:30%">Genotype</th><th style="width:60%">Banding Pattern</th></tr>')),i=0;i<t.lanes.length;i+=1)d=n(t.lanes[i].bands),s=h("<tr>",{html:"<td>"+(i+1)+'</td><td id="'+d.genotype_id+'">'+t.lanes[i].genotype+"</td><td>"+d.string+"</td></th>"}),o.append(s),u.push(s),h("#"+d.form_id).keyup(a(d));g=!1,m=!0,c.show()})},d=function(){var e,t,n;return t=h(p.children()[0]),e=document.createElement("canvas"),e.width=p.width(),e.height=p.height(),n=e.getContext("2d"),n.drawImage(t[0],t.css("margin-left").replace(/px/,""),t.css("margin-top").replace(/px/,""),t.css("width").replace(/px/,""),t.css("width").replace(/px/,"")*t.height()/t.width()),console.log("here to crop"),Promise.resolve({imgURL:e.toDataURL(),width:e.width,height:e.height})},o=function(){var e,t,n,a,i,o,r,d=1e3;for(e='<style type="text/css"> .tg {border-collapse:collapse;border-spacing:0;border-color:#ccc;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#fff;border-top-width:1px;border-bottom-width:1px;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#f0f0f0;border-top-width:1px;border-bottom-width:1px;} .tg .tg-5xks{font-weight:bold;font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;text-align:left;vertical-align:top} .tg .tg-ump5{font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;vertical-align:top} </style>',i=h("<div>"),t=h("<table>",{"class":"tg",style:"width:"+d+"px"}).appendTo(i),n=h("<tr>").appendTo(t),n.append(h("<th>",{"class":"tg-5xks",text:"Lane",style:"width:10%"})),n.append(h("<th>",{"class":"tg-5xks",text:"Genotype",style:"width:25%"})),n.append(h("<th>",{"class":"tg-5xks",text:"Banding Pattern",style:"width:20%"})),n.append(h("<th>",{"class":"tg-5xks",text:"Notes",style:"width:45%"})),a=0;a<u.length;a+=1)n=h("<tr>").appendTo(t),n.append(h("<td>",{"class":"tg-ump5",text:h(u[a].children()[0]).text()})),n.append(h("<td>",{"class":"tg-ump5",text:h(u[a].children()[1]).text()})),n.append(h("<td>",{"class":"tg-ump5",text:h(u[a].children()[2]).children().val().split(/\D+/).join(", ")})),n.append(h("<td>",{"class":"tg-ump5",html:"&nbsp;"}));return e+=i.html().replace(/<\/*tbody>/,""),o=h(e),h(o[1]).css("width",d),h(o[1]).css("visibility","hidden"),h(o[1]).css("position","absolute"),h(o[1]).css("display","block"),h("body").prepend(o),r=document.createElement("canvas"),r.setAttribute("crossOrigin","anonymous"),r.width=d+15,r.id="tempTableCanvas",r.height=h(o[1]).height()+80,rasterizeHTML.drawHTML(e,r).then(function(){return{imgURL:r.toDataURL("data:image/svg+xml;utf8"),width:r.width,height:r.height}})},s=function(e){var t,n,a=new jsPDF,i=20;d().then(function(e){var n=170;return t=Math.round(170*e.height/e.width),t>60&&(n=20+60/t*150,t=60),a.addImage(e.imgURL,"png",20,i,n,t)}).then(function(){return i+=t,o()}).then(function(e){return a.addImage(e.imgURL,"svg",20,i,170,Math.round(170*e.height/e.width))}).then(function(){return a.addPage(),a.setPage(2),n=Math.min(p.children().height()/p.children().width(),11/8.5),a.addImage(p.children()[0].toDataURL(),"png",0,0,210,210*n)}).then(function(){a.save(e),m=!0})},i=function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var n,a=new FileReader;a.onload=function(a){n=a.target.result,e.name.match(/\.pdf$/)?hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:n,scale:2.25}}).then(t):hcvGenie.findBands({image:{type:"png",url:n}}).then(t)},a.readAsDataURL(e)}else window.alert("The File APIs are not fully supported in this browser.")},r=function(e){var t;t=e.all?function(){p.empty(),p.css("overflow",""),p.css("height",""),p.append(e.canvas.width(p.width())),console.log("resizing all")}:function(){var t,n,a,i,o,r;p.empty(),t=p.width(),a=Math.min(e.region.min[0],e.region.width-e.region.max[0]),i=e.region.width-2*a,n=t/i,o=-1*e.region.min[1]*n,r=(e.region.max[1]-e.region.min[1])*n,p.css("overflow","hidden"),p.css("height",r),p.append(e.canvas.width(t+2*a*n)),e.canvas.css("margin-top",o),e.canvas.css("margin-left",-a*n),console.log("resizing part",t,i)},t(),h(window).unbind("resize"),h(window).resize(t)},function(){var t,n,a,o,r=!1;t=h(".demoFile"),n=h(".computerFile"),a=h(".saveFile"),(!window.Blob||navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i))&&a.hide(),o=document.createElement("span"),(!1 in o||!("ondragleave"in o&&"ondragover"in o&&"ondrop"in o))&&c.parent().empty(),/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge\ |maemo|midp|mmp|netfront|opera\ m(ob|in)i|palm(\ os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows\ (ce|phone)|xda|xiino/i.test(navigator.userAgent)&&c.parent().empty(),t.click(function(t){t.preventDefault(),g||(l.empty(),p.empty().text("Grabbing the image from the server, this may take a few seconds."),g=!0,m=!1,c.hide(),e())}),n.change(function(e){g?e.preventDefault():(l.empty(),p.empty(),g=!0,m=!1,c.hide(),i(e.target.files[0]))}),a.click(function(e){e.preventDefault(),m&&(m=!1,s("HCV_genie_"+(new Date).toLocaleString().replace(/[\/\,\s\:]+/g,"_")))}),c.on("dragover",function(e){return e.preventDefault(),e.stopPropagation(),r||g||(c.addClass("hover"),r=!0),!1}),c.on("dragleave",function(e){return e.preventDefault(),e.stopPropagation(),c.removeClass("hover"),r=!1,!1}),c.on("drop",function(e){e.preventDefault(),e.stopPropagation(),c.removeClass("hover"),r=!1,g||(l.empty(),p.empty(),g=!0,m=!1,c.hide(),i(e.originalEvent.dataTransfer.files[0]))})}()}();