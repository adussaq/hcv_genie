var glob,global2=[];!function(){"use strict";var e,t,a,n,i,o,r,s,d,l,h,c,p,g,f,m,u,w=jQuery,v=!1,b=!1,x=[];c=w("#textResults"),p=w("#imageResults");var y=w("#fixer");y.on("affix.bs.affix",function(){y.parent().css("min-height",p.height()),y.css("max-width",p.width())}),y.affix({offset:{top:y.offset().top-51}}),window.onresize=function(){var e=w('<div id="fixer"></div>');p.detach().appendTo(e),e.appendTo(y.parent()),y.remove(),y=e,y.on("affix.bs.affix",function(){y.parent().css("min-height",p.height()),y.css("max-width",p.width())}),y.affix({offset:{top:y.offset().top-51}}),y.parent().css("min-height",p.height()),y.css("max-width",p.width())},g=w("#drop"),e=function(){var e=Math.round(46*Math.random()+1);h&&hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:"../dataExamples/pages/page"+e+".pdf",scale:2.25,parameters:h},onchange:l}).then(t)},a=function(e){return function(e){var t,a,n;return a=Math.random().toString(12).replace("0.",""),n=Math.random().toString(12).replace("0.",""),t='<input id="'+a+'" type="text" class="form-control" value="'+e.map(function(e){return e.call}).join(", ")+'">',{string:t,form_id:a,genotype_id:n}}(e)},n=function(e){return function(t){var a,n;t.preventDefault(),a=w("#"+e.form_id).val(),a.match(/^[\s,\d]+$/)&&(n=a.split(/,|\s|;/),hcvGenie.genotype(n).then(function(t){w("#"+e.genotype_id).text(t)}))}},t=function(e){var t;p.empty(),r({canvas:w(e.canvas),all:!0}),x=[],e.bandingPromise.then(function(e){return t=e,t.lanePromise}).then(function(a){r({canvas:w(e.canvas),all:!1,region:a.region}),glob=t,l(a.lanes()),v=!1,b=!0,f.toggleClass("disabled"),m.toggleClass("disabled"),u.toggleClass("disabled"),g.show()})},l=function(e){var t,i,o,r,s=[];for(i=w('<table class="table table-hover" style="width:100%">'),c.empty(),x=[],c.append("<p>*<em>To change band calls begin by interacting with the image. Any changes to the table below will only be indicated in the report. Any changes done to the image will overwrite changes performed on the table in favor of the image state.</em></p>"),i.appendTo(c),i.append(w('<tr><th style="width:10%">Lane</th><th style="width:30%">Genotype</th><th style="width:60%">Banding Pattern</th></tr>')),t=0;t<e.length;t+=1)o=a(e[t].bands),r=w("<tr>",{html:"<td>"+(t+1)+'</td><td id="'+o.genotype_id+'">'+e[t].genotype+"</td><td>"+o.string+"</td></th>"}),s.push(t+1+"\t "+o.string.replace(/[\S\s]+\"([\d,\s]+)\">?/,"$1")+"\t "+e[t].genotype),i.append(r),x.push(r),w("#"+o.form_id).keyup(n(o));console.log(s.join("\n"))},s=function(){var e,t,a=w(p.children()[0]),n=w(p.children().children()[0]),i=w(p.children().children()[1]);return e=document.createElement("canvas"),e.width=p.width(),e.height=p.height(),t=e.getContext("2d"),t.drawImage(n[0],a.css("margin-left").replace(/px/,""),a.css("margin-top").replace(/px/,""),a.css("width").replace(/px/,""),a.css("width").replace(/px/,"")*n.height()/n.width()),t.drawImage(i[0],a.css("margin-left").replace(/px/,""),a.css("margin-top").replace(/px/,""),a.css("width").replace(/px/,""),a.css("width").replace(/px/,"")*n.height()/n.width()),Promise.resolve({imgURL:e.toDataURL(),width:e.width,height:e.height})},o=function(){var e,t,a,n,i,o,r;for(e='<style type="text/css"> .tg {border-collapse:collapse;border-spacing:0;border-color:#ccc;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#fff;border-top-width:1px;border-bottom-width:1px;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#f0f0f0;border-top-width:1px;border-bottom-width:1px;} .tg .tg-5xks{font-weight:bold;font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;text-align:left;vertical-align:top} .tg .tg-ump5{font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;vertical-align:top} </style>',i=w("<div>"),t=w("<table>",{class:"tg",style:"width:1000px"}).appendTo(i),a=w("<tr>").appendTo(t),a.append(w("<th>",{class:"tg-5xks",text:"Lane",style:"width:10%"})),a.append(w("<th>",{class:"tg-5xks",text:"Genotype",style:"width:25%"})),a.append(w("<th>",{class:"tg-5xks",text:"Banding Pattern",style:"width:20%"})),a.append(w("<th>",{class:"tg-5xks",text:"Notes",style:"width:45%"})),n=0;n<x.length;n+=1)a=w("<tr>").appendTo(t),a.append(w("<td>",{class:"tg-ump5",text:w(x[n].children()[0]).text()})),a.append(w("<td>",{class:"tg-ump5",text:w(x[n].children()[1]).text()})),a.append(w("<td>",{class:"tg-ump5",text:w(x[n].children()[2]).children().val().split(/\D+/).join(", ")})),a.append(w("<td>",{class:"tg-ump5",html:"&nbsp;"}));return e+=i.html().replace(/<\/*tbody>/,""),o=w(e),w(o[1]).css("width",1e3),w(o[1]).css("visibility","hidden"),w(o[1]).css("position","absolute"),w(o[1]).css("display","block"),w("body").prepend(o),r=document.createElement("canvas"),r.setAttribute("crossOrigin","anonymous"),r.width=1015,r.id="tempTableCanvas",r.height=w(o[1]).height()+80,rasterizeHTML.drawHTML(e,r).then(function(){return{imgURL:r.toDataURL("data:image/svg+xml;utf8"),width:r.width,height:r.height}})},d=function(e){var t,a,n=new jsPDF,i=20;s().then(function(e){var a=170;return t=Math.round(170*e.height/e.width),t>60&&(a=20+60/t*150,t=60),n.addImage(e.imgURL,"png",20,i,a,t)}).then(function(){return i+=t,o()}).then(function(e){return n.addImage(e.imgURL,"svg",20,i,170,Math.round(170*e.height/e.width))}).then(function(){return n.addPage(),n.setPage(2),a=Math.min(p.children().height()/p.children().width(),11/8.5),n.addImage(p.children().children()[0].toDataURL(),"png",0,0,210,210*a)}).then(function(){n.save(e),b=!0})},i=function(e){if(h&&window.File&&window.FileReader&&window.FileList&&window.Blob){var a,n=new FileReader;n.onload=function(n){a=n.target.result,e.name.match(/\.pdf$/)?hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:a,scale:2.2,parameters:h},onchange:l}).then(t):hcvGenie.findBands({image:{type:"png",url:a,parameters:h},onchange:l}).then(t)},n.readAsDataURL(e)}else window.alert("The File APIs are not fully supported in this browser.")},r=function(e){var t;t=e.all?function(){p.css("overflow",""),p.css("height",""),p.append(e.canvas.width(p.width()))}:function(){var t,a,n,i,o,r;t=p.width(),n=Math.min(e.region.min[0],e.region.width-e.region.max[0]),i=e.region.width-2*n,a=t/i,o=-1*e.region.min[1]*a,r=(e.region.max[1]-e.region.min[1])*a,p.css("overflow","hidden"),p.css("position","relative"),p.css("height",r),p.attr("class","my-img-thumbnail"),p.append(e.canvas.width(t+2*n*a)),e.canvas.css("margin-top",o),e.canvas.css("margin-left",-n*a)},t(),w(window).unbind("resize"),w(window).resize(t)},function(){var t,a,n=!1;m=w(".demoFile"),a=w(".computerFile"),u=w(".computerFileButton"),f=w(".saveFile"),f.toggleClass("disabled"),(!window.Blob||navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i))&&f.hide(),t=document.createElement("span"),(!1 in t||!("ondragleave"in t&&"ondragover"in t&&"ondrop"in t))&&g.parent().empty(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera\ Mini/i.test(navigator.userAgent)&&g.parent().empty(),m.click(function(t){t.preventDefault(),v||(c.empty(),p.empty().text("Grabbing the image from the server, this may take a few seconds."),v=!0,b=!1,g.hide(),e(),f.hasClass("disabled")||f.toggleClass("disabled"),m.toggleClass("disabled"),u.toggleClass("disabled"))}),a.change(function(e){v?e.preventDefault():(c.empty(),p.empty(),v=!0,b=!1,g.hide(),i(e.target.files[0]),f.hasClass("disabled")||f.toggleClass("disabled"),m.toggleClass("disabled"),u.toggleClass("disabled"))}),f.click(function(e){e.preventDefault(),b&&(b=!1,d("HCV_genie_"+(new Date).toLocaleString().replace(/[\/\,\s\:]+/g,"_")))}),g.on("dragover",function(e){return e.preventDefault(),e.stopPropagation(),n||v||(g.addClass("hover"),n=!0),!1}),g.on("dragleave",function(e){return e.preventDefault(),e.stopPropagation(),g.removeClass("hover"),n=!1,!1}),g.on("drop",function(e){e.preventDefault(),e.stopPropagation(),g.removeClass("hover"),n=!1,v||(c.empty(),p.empty(),f.hasClass("disabled")||f.toggleClass("disabled"),m.toggleClass("disabled"),u.toggleClass("disabled"),v=!0,b=!1,g.hide(),i(e.originalEvent.dataTransfer.files[0]))})}(),function(){w('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=w(e.target).attr("href");window.location.hash="#home"!==t?t:"",window.scrollTo(0,0)})}(),window.onload=function(){var e;window.scrollTo(0,0),window.location.hash&&w('a[href="'+window.location.hash+'"]').click(),e=window.location.search&&window.location.search.match(/[?&]data=[^&?#]+/)?window.location.search.match(/([?&]data=)([^&?#]+)/)[2]:"/json/default_params.json",w.get(e,function(e){h=e}).fail(function(){w("#home").children().hide(),w("#home").append('<div class="container well">Failed to load constants object, this tool does not work without that. Please provide it in the url using a data= tag, or remove the data= tag to utilize the defaults.</div>'),alert("Failed to get constants object, make sure your '?data=...' URL is correct and CORS enabled.")})}}();