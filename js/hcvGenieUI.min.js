!function(){"use strict";var e,t,n,a,i,r,o,d,s,l,c,p,h=jQuery,g=!1,u=!1,f=[];l=h("#textResults"),c=h("#imageResults"),p=h("#drop"),e=function(){var e=Math.round(19*Math.random()+1);hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:"./dataExamples/pages/samples1-20_page"+e+".pdf",scale:2.25}}).then(t)},n=function(e){return function(e){var t,n,a;return n=Math.random().toString(12).replace("0.",""),a=Math.random().toString(12).replace("0.",""),t='<input id="'+n+'" type="text" class="form-control" value="'+e.map(function(e){return e.call}).join(", ")+'">',{string:t,form_id:n,genotype_id:a}}(e)},a=function(e){return function(t){var n,a;t.preventDefault(),n=h("#"+e.form_id).val(),n.match(/^[\s,\d]+$/)&&(a=n.split(/,/),hcvGenie.genotype(a).then(function(t){console.log(t),h("#"+e.genotype_id).text(t)}))}},t=function(e){o({canvas:h(e.canvas),all:!0}),f=[],e.bandLocationPromise.then(function(t){var i,r,d,s;for(console.log("here",t.lanes,t.region),o({canvas:h(e.canvas),all:!1,region:t.region}),r=h('<table class="table table-hover" style="width:100%">'),r.appendTo(l),r.append(h('<tr><th style="width:10%">Lane</th><th style="width:30%">Genotype</th><th style="width:60%">Banding Pattern</th></tr>')),i=0;i<t.lanes.length;i+=1)d=n(t.lanes[i].bands),s=h("<tr>",{html:"<td>"+(i+1)+'</td><td id="'+d.genotype_id+'">'+t.lanes[i].genotype+"</td><td>"+d.string+"</td></th>"}),r.append(s),f.push(s),h("#"+d.form_id).keyup(a(d));g=!1,u=!0,p.show()})},d=function(){var e,t,n;return t=h(c.children()[0]),e=document.createElement("canvas"),e.width=c.width(),e.height=c.height(),n=e.getContext("2d"),n.drawImage(t[0],t.css("margin-left").replace(/px/,""),t.css("margin-top").replace(/px/,""),t.css("width").replace(/px/,""),t.css("width").replace(/px/,"")*t.height()/t.width()),console.log("here to crop"),Promise.resolve({imgURL:e.toDataURL(),width:e.width,height:e.height})},r=function(){var e,t,n,a,i,r,o,d=1e3;for(e='<style type="text/css"> .tg {border-collapse:collapse;border-spacing:0;border-color:#ccc;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#fff;border-top-width:1px;border-bottom-width:1px;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#f0f0f0;border-top-width:1px;border-bottom-width:1px;} .tg .tg-5xks{font-weight:bold;font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;text-align:left;vertical-align:top} .tg .tg-ump5{font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;vertical-align:top} </style>',i=h("<div>"),t=h("<table>",{"class":"tg",style:"width:"+d+"px"}).appendTo(i),n=h("<tr>").appendTo(t),n.append(h("<th>",{"class":"tg-5xks",text:"Lane",style:"width:10%"})),n.append(h("<th>",{"class":"tg-5xks",text:"Genotype",style:"width:25%"})),n.append(h("<th>",{"class":"tg-5xks",text:"Banding Pattern",style:"width:20%"})),n.append(h("<th>",{"class":"tg-5xks",text:"Notes",style:"width:45%"})),a=0;a<f.length;a+=1)n=h("<tr>").appendTo(t),n.append(h("<td>",{"class":"tg-ump5",text:h(f[a].children()[0]).text()})),n.append(h("<td>",{"class":"tg-ump5",text:h(f[a].children()[1]).text()})),n.append(h("<td>",{"class":"tg-ump5",text:h(f[a].children()[2]).children().val().split(/\D+/).join(", ")})),n.append(h("<td>",{"class":"tg-ump5",html:"&nbsp;"}));return e+=i.html().replace(/<\/*tbody>/,""),r=h(e),h(r[1]).css("width",d),h(r[1]).css("visibility","hidden"),h(r[1]).css("position","absolute"),h(r[1]).css("display","block"),h("body").prepend(r),o=document.createElement("canvas"),o.setAttribute("crossOrigin","anonymous"),o.width=d+15,o.id="tempTableCanvas",o.height=h(r[1]).height()+80,rasterizeHTML.drawHTML(e,o).then(function(){return{imgURL:o.toDataURL("data:image/svg+xml;utf8"),width:o.width,height:o.height}})},s=function(e){var t,n,a=new jsPDF,i=20;d().then(function(e){var n=170;return t=Math.round(170*e.height/e.width),t>60&&(n=20+60/t*150,t=60),a.addImage(e.imgURL,"png",20,i,n,t)}).then(function(){return i+=t,r()}).then(function(e){return a.addImage(e.imgURL,"svg",20,i,170,Math.round(170*e.height/e.width))}).then(function(){return a.addPage(),a.setPage(2),n=Math.min(c.children().height()/c.children().width(),11/8.5),a.addImage(c.children()[0].toDataURL(),"png",0,0,210,210*n)}).then(function(){a.save(e),u=!0})},i=function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var n,a=new FileReader;a.onload=function(a){n=a.target.result,e.name.match(/\.pdf$/)?hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:n,scale:2.25}}).then(t):hcvGenie.findBands({image:{type:"png",url:n}}).then(t)},a.readAsDataURL(e)}else window.alert("The File APIs are not fully supported in this browser.")},o=function(e){var t;t=e.all?function(){c.empty(),c.css("overflow",""),c.css("height",""),c.append(e.canvas.width(c.width())),console.log("resizing all")}:function(){var t,n,a,i,r,o;c.empty(),t=c.width(),a=Math.min(e.region.min[0],e.region.width-e.region.max[0]),i=e.region.width-2*a,n=t/i,r=-1*e.region.min[1]*n,o=(e.region.max[1]-e.region.min[1])*n,c.css("overflow","hidden"),c.css("height",o),c.append(e.canvas.width(t+2*a*n)),e.canvas.css("margin-top",r),e.canvas.css("margin-left",-a*n),console.log("resizing part",t,i)},t(),h(window).unbind("resize"),h(window).resize(t)},function(){var t,n,a,r,o=!1;t=h(".demoFile"),n=h(".computerFile"),a=h(".saveFile"),(!window.Blob||navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i))&&a.hide(),r=document.createElement("span"),(!1 in r||!("ondragleave"in r&&"ondragover"in r&&"ondrop"in r))&&p.parent().empty(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera\ Mini/i.test(navigator.userAgent)&&p.parent().empty(),t.click(function(t){t.preventDefault(),g||(l.empty(),c.empty().text("Grabbing the image from the server, this may take a few seconds."),g=!0,u=!1,p.hide(),e())}),n.change(function(e){g?e.preventDefault():(l.empty(),c.empty(),g=!0,u=!1,p.hide(),i(e.target.files[0]))}),a.click(function(e){e.preventDefault(),u&&(u=!1,s("HCV_genie_"+(new Date).toLocaleString().replace(/[\/\,\s\:]+/g,"_")))}),p.on("dragover",function(e){return e.preventDefault(),e.stopPropagation(),o||g||(p.addClass("hover"),o=!0),!1}),p.on("dragleave",function(e){return e.preventDefault(),e.stopPropagation(),p.removeClass("hover"),o=!1,!1}),p.on("drop",function(e){e.preventDefault(),e.stopPropagation(),p.removeClass("hover"),o=!1,g||(l.empty(),c.empty(),g=!0,u=!1,p.hide(),i(e.originalEvent.dataTransfer.files[0]))})}()}();