!function(){"use strict";var e,t,n,a,i,o,r,s,d,l,c,g,p,h,u,m=jQuery,f=!1,w=!1,v=[];l=m("#textResults"),c=m("#imageResults"),g=m("#drop"),e=function(){var e=Math.round(19*Math.random()+1);hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:"./dataExamples/pages/samples1-20_page"+e+".pdf",scale:2.25}}).then(t)},n=function(e){return function(e){var t,n,a;return n=Math.random().toString(12).replace("0.",""),a=Math.random().toString(12).replace("0.",""),t='<input id="'+n+'" type="text" class="form-control" value="'+e.map(function(e){return e.call}).join(", ")+'">',{string:t,form_id:n,genotype_id:a}}(e)},a=function(e){return function(t){var n,a;t.preventDefault(),n=m("#"+e.form_id).val(),n.match(/^[\s,\d]+$/)&&(a=n.split(/,/),hcvGenie.genotype(a).then(function(t){console.log(t),m("#"+e.genotype_id).text(t)}))}},t=function(e){r({canvas:m(e.canvas),all:!0}),v=[],e.bandLocationPromise.then(function(t){var i,o,s,d;for(console.log("here",t.lanes,t.region),r({canvas:m(e.canvas),all:!1,region:t.region}),o=m('<table class="table table-hover" style="width:100%">'),o.appendTo(l),o.append(m('<tr><th style="width:10%">Lane</th><th style="width:30%">Genotype</th><th style="width:60%">Banding Pattern</th></tr>')),i=0;i<t.lanes.length;i+=1)s=n(t.lanes[i].bands),d=m("<tr>",{html:"<td>"+(i+1)+'</td><td id="'+s.genotype_id+'">'+t.lanes[i].genotype+"</td><td>"+s.string+"</td></th>"}),o.append(d),v.push(d),m("#"+s.form_id).keyup(a(s));f=!1,w=!0,p.toggleClass("disabled"),h.toggleClass("disabled"),u.toggleClass("disabled"),g.show()})},s=function(){var e,t,n;return t=m(c.children()[0]),e=document.createElement("canvas"),e.width=c.width(),e.height=c.height(),n=e.getContext("2d"),n.drawImage(t[0],t.css("margin-left").replace(/px/,""),t.css("margin-top").replace(/px/,""),t.css("width").replace(/px/,""),t.css("width").replace(/px/,"")*t.height()/t.width()),console.log("here to crop"),Promise.resolve({imgURL:e.toDataURL(),width:e.width,height:e.height})},o=function(){var e,t,n,a,i,o,r,s=1e3;for(e='<style type="text/css"> .tg {border-collapse:collapse;border-spacing:0;border-color:#ccc;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#fff;border-top-width:1px;border-bottom-width:1px;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#f0f0f0;border-top-width:1px;border-bottom-width:1px;} .tg .tg-5xks{font-weight:bold;font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;text-align:left;vertical-align:top} .tg .tg-ump5{font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;vertical-align:top} </style>',i=m("<div>"),t=m("<table>",{"class":"tg",style:"width:"+s+"px"}).appendTo(i),n=m("<tr>").appendTo(t),n.append(m("<th>",{"class":"tg-5xks",text:"Lane",style:"width:10%"})),n.append(m("<th>",{"class":"tg-5xks",text:"Genotype",style:"width:25%"})),n.append(m("<th>",{"class":"tg-5xks",text:"Banding Pattern",style:"width:20%"})),n.append(m("<th>",{"class":"tg-5xks",text:"Notes",style:"width:45%"})),a=0;a<v.length;a+=1)n=m("<tr>").appendTo(t),n.append(m("<td>",{"class":"tg-ump5",text:m(v[a].children()[0]).text()})),n.append(m("<td>",{"class":"tg-ump5",text:m(v[a].children()[1]).text()})),n.append(m("<td>",{"class":"tg-ump5",text:m(v[a].children()[2]).children().val().split(/\D+/).join(", ")})),n.append(m("<td>",{"class":"tg-ump5",html:"&nbsp;"}));return e+=i.html().replace(/<\/*tbody>/,""),o=m(e),m(o[1]).css("width",s),m(o[1]).css("visibility","hidden"),m(o[1]).css("position","absolute"),m(o[1]).css("display","block"),m("body").prepend(o),r=document.createElement("canvas"),r.setAttribute("crossOrigin","anonymous"),r.width=s+15,r.id="tempTableCanvas",r.height=m(o[1]).height()+80,rasterizeHTML.drawHTML(e,r).then(function(){return{imgURL:r.toDataURL("data:image/svg+xml;utf8"),width:r.width,height:r.height}})},d=function(e){var t,n,a=new jsPDF,i=20;s().then(function(e){var n=170;return t=Math.round(170*e.height/e.width),t>60&&(n=20+60/t*150,t=60),a.addImage(e.imgURL,"png",20,i,n,t)}).then(function(){return i+=t,o()}).then(function(e){return a.addImage(e.imgURL,"svg",20,i,170,Math.round(170*e.height/e.width))}).then(function(){return a.addPage(),a.setPage(2),n=Math.min(c.children().height()/c.children().width(),11/8.5),a.addImage(c.children()[0].toDataURL(),"png",0,0,210,210*n)}).then(function(){a.save(e),w=!0})},i=function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var n,a=new FileReader;a.onload=function(a){n=a.target.result,e.name.match(/\.pdf$/)?hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:n,scale:2.25}}).then(t):hcvGenie.findBands({image:{type:"png",url:n}}).then(t)},a.readAsDataURL(e)}else window.alert("The File APIs are not fully supported in this browser.")},r=function(e){var t;t=e.all?function(){c.empty(),c.css("overflow",""),c.css("height",""),c.append(e.canvas.width(c.width())),console.log("resizing all")}:function(){var t,n,a,i,o,r;c.empty(),t=c.width(),a=Math.min(e.region.min[0],e.region.width-e.region.max[0]),i=e.region.width-2*a,n=t/i,o=-1*e.region.min[1]*n,r=(e.region.max[1]-e.region.min[1])*n,c.css("overflow","hidden"),c.css("height",r),c.append(e.canvas.width(t+2*a*n)),e.canvas.css("margin-top",o),e.canvas.css("margin-left",-a*n),console.log("resizing part",t,i)},t(),m(window).unbind("resize"),m(window).resize(t)},function(){var t,n,a=!1;h=m(".demoFile"),n=m(".computerFile"),u=m(".computerFileButton"),p=m(".saveFile"),p.toggleClass("disabled"),(!window.Blob||navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i))&&p.hide(),t=document.createElement("span"),(!1 in t||!("ondragleave"in t&&"ondragover"in t&&"ondrop"in t))&&g.parent().empty(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera\ Mini/i.test(navigator.userAgent)&&g.parent().empty(),h.click(function(t){t.preventDefault(),f||(l.empty(),c.empty().text("Grabbing the image from the server, this may take a few seconds."),f=!0,w=!1,g.hide(),e(),p.hasClass("disabled")||p.toggleClass("disabled"),h.toggleClass("disabled"),u.toggleClass("disabled"))}),n.change(function(e){f?e.preventDefault():(l.empty(),c.empty(),f=!0,w=!1,g.hide(),i(e.target.files[0]),p.hasClass("disabled")||p.toggleClass("disabled"),h.toggleClass("disabled"),u.toggleClass("disabled"))}),p.click(function(e){e.preventDefault(),w&&(w=!1,d("HCV_genie_"+(new Date).toLocaleString().replace(/[\/\,\s\:]+/g,"_")))}),g.on("dragover",function(e){return e.preventDefault(),e.stopPropagation(),a||f||(g.addClass("hover"),a=!0),!1}),g.on("dragleave",function(e){return e.preventDefault(),e.stopPropagation(),g.removeClass("hover"),a=!1,!1}),g.on("drop",function(e){e.preventDefault(),e.stopPropagation(),g.removeClass("hover"),a=!1,f||(l.empty(),c.empty(),p.hasClass("disabled")||p.toggleClass("disabled"),h.toggleClass("disabled"),u.toggleClass("disabled"),f=!0,w=!1,g.hide(),i(e.originalEvent.dataTransfer.files[0]))})}()}();