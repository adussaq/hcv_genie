var glob,global2=[];!function(){"use strict";var e,t,n,a,i,o,r,s,d,l,h,c,p,g,f,m,u=jQuery,w=!1,v=!1,b=[];h=u("#textResults"),c=u("#imageResults");var x=u("#fixer");x.on("affix.bs.affix",function(){x.parent().css("min-height",c.height()),x.css("max-width",c.width())}),x.affix({offset:{top:x.offset().top-51}}),window.onresize=function(){var e=u('<div id="fixer"></div>');c.detach().appendTo(e),e.appendTo(x.parent()),x.remove(),x=e,x.on("affix.bs.affix",function(){x.parent().css("min-height",c.height()),x.css("max-width",c.width())}),x.affix({offset:{top:x.offset().top-51}}),x.parent().css("min-height",c.height()),x.css("max-width",c.width())},p=u("#drop"),e=function(){var e=Math.round(46*Math.random()+1);hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:"../dataExamples/pages/page"+e+".pdf",scale:2.25},onchange:l}).then(t)},n=function(e){return function(e){var t,n,a;return n=Math.random().toString(12).replace("0.",""),a=Math.random().toString(12).replace("0.",""),t='<input id="'+n+'" type="text" class="form-control" value="'+e.map(function(e){return e.call}).join(", ")+'">',{string:t,form_id:n,genotype_id:a}}(e)},a=function(e){return function(t){var n,a;t.preventDefault(),n=u("#"+e.form_id).val(),n.match(/^[\s,\d]+$/)&&(a=n.split(/,|\s|;/),hcvGenie.genotype(a).then(function(t){u("#"+e.genotype_id).text(t)}))}},t=function(e){var t;c.empty(),r({canvas:u(e.canvas),all:!0}),b=[],e.bandingPromise.then(function(e){return t=e,t.lanePromise}).then(function(n){r({canvas:u(e.canvas),all:!1,region:n.region}),glob=t,l(n.lanes()),w=!1,v=!0,g.toggleClass("disabled"),f.toggleClass("disabled"),m.toggleClass("disabled"),p.show()})},l=function(e){var t,i,o,r,s=[];for(i=u('<table class="table table-hover" style="width:100%">'),h.empty(),b=[],h.append("<p>*<em>To change band calls begin by interacting with the image. Any changes to the table below will only be indicated in the report. Any changes done to the image will overwrite changes performed on the table in favor of the image state.</em></p>"),i.appendTo(h),i.append(u('<tr><th style="width:10%">Lane</th><th style="width:30%">Genotype</th><th style="width:60%">Banding Pattern</th></tr>')),t=0;t<e.length;t+=1)o=n(e[t].bands),r=u("<tr>",{html:"<td>"+(t+1)+'</td><td id="'+o.genotype_id+'">'+e[t].genotype+"</td><td>"+o.string+"</td></th>"}),s.push(t+1+"\t "+o.string.replace(/[\S\s]+\"([\d,\s]+)\">?/,"$1")+"\t "+e[t].genotype),i.append(r),b.push(r),u("#"+o.form_id).keyup(a(o));console.log(s.join("\n"))},s=function(){var e,t,n=u(c.children()[0]),a=u(c.children().children()[0]),i=u(c.children().children()[1]);return e=document.createElement("canvas"),e.width=c.width(),e.height=c.height(),t=e.getContext("2d"),t.drawImage(a[0],n.css("margin-left").replace(/px/,""),n.css("margin-top").replace(/px/,""),n.css("width").replace(/px/,""),n.css("width").replace(/px/,"")*a.height()/a.width()),t.drawImage(i[0],n.css("margin-left").replace(/px/,""),n.css("margin-top").replace(/px/,""),n.css("width").replace(/px/,""),n.css("width").replace(/px/,"")*a.height()/a.width()),Promise.resolve({imgURL:e.toDataURL(),width:e.width,height:e.height})},o=function(){var e,t,n,a,i,o,r;for(e='<style type="text/css"> .tg {border-collapse:collapse;border-spacing:0;border-color:#ccc;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#fff;border-top-width:1px;border-bottom-width:1px;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#f0f0f0;border-top-width:1px;border-bottom-width:1px;} .tg .tg-5xks{font-weight:bold;font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;text-align:left;vertical-align:top} .tg .tg-ump5{font-family:"Lucida Sans Unicode", "Lucida Grande", sans-serif !important;;vertical-align:top} </style>',i=u("<div>"),t=u("<table>",{class:"tg",style:"width:1000px"}).appendTo(i),n=u("<tr>").appendTo(t),n.append(u("<th>",{class:"tg-5xks",text:"Lane",style:"width:10%"})),n.append(u("<th>",{class:"tg-5xks",text:"Genotype",style:"width:25%"})),n.append(u("<th>",{class:"tg-5xks",text:"Banding Pattern",style:"width:20%"})),n.append(u("<th>",{class:"tg-5xks",text:"Notes",style:"width:45%"})),a=0;a<b.length;a+=1)n=u("<tr>").appendTo(t),n.append(u("<td>",{class:"tg-ump5",text:u(b[a].children()[0]).text()})),n.append(u("<td>",{class:"tg-ump5",text:u(b[a].children()[1]).text()})),n.append(u("<td>",{class:"tg-ump5",text:u(b[a].children()[2]).children().val().split(/\D+/).join(", ")})),n.append(u("<td>",{class:"tg-ump5",html:"&nbsp;"}));return e+=i.html().replace(/<\/*tbody>/,""),o=u(e),u(o[1]).css("width",1e3),u(o[1]).css("visibility","hidden"),u(o[1]).css("position","absolute"),u(o[1]).css("display","block"),u("body").prepend(o),r=document.createElement("canvas"),r.setAttribute("crossOrigin","anonymous"),r.width=1015,r.id="tempTableCanvas",r.height=u(o[1]).height()+80,rasterizeHTML.drawHTML(e,r).then(function(){return{imgURL:r.toDataURL("data:image/svg+xml;utf8"),width:r.width,height:r.height}})},d=function(e){var t,n,a=new jsPDF,i=20;s().then(function(e){var n=170;return t=Math.round(170*e.height/e.width),t>60&&(n=20+60/t*150,t=60),a.addImage(e.imgURL,"png",20,i,n,t)}).then(function(){return i+=t,o()}).then(function(e){return a.addImage(e.imgURL,"svg",20,i,170,Math.round(170*e.height/e.width))}).then(function(){return a.addPage(),a.setPage(2),n=Math.min(c.children().height()/c.children().width(),11/8.5),a.addImage(c.children().children()[0].toDataURL(),"png",0,0,210,210*n)}).then(function(){a.save(e),v=!0})},i=function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var n,a=new FileReader;a.onload=function(a){n=a.target.result,e.name.match(/\.pdf$/)?hcvGenie.findBands({image:{type:"pdf",pageNumber:1,url:n,scale:2.2},onchange:l}).then(t):hcvGenie.findBands({image:{type:"png",url:n},onchange:l}).then(t)},a.readAsDataURL(e)}else window.alert("The File APIs are not fully supported in this browser.")},r=function(e){var t;t=e.all?function(){c.css("overflow",""),c.css("height",""),c.append(e.canvas.width(c.width()))}:function(){var t,n,a,i,o,r;t=c.width(),a=Math.min(e.region.min[0],e.region.width-e.region.max[0]),i=e.region.width-2*a,n=t/i,o=-1*e.region.min[1]*n,r=(e.region.max[1]-e.region.min[1])*n,c.css("overflow","hidden"),c.css("position","relative"),c.css("height",r),c.attr("class","my-img-thumbnail"),c.append(e.canvas.width(t+2*a*n)),e.canvas.css("margin-top",o),e.canvas.css("margin-left",-a*n)},t(),u(window).unbind("resize"),u(window).resize(t)},function(){var t,n,a=!1;f=u(".demoFile"),n=u(".computerFile"),m=u(".computerFileButton"),g=u(".saveFile"),g.toggleClass("disabled"),(!window.Blob||navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i))&&g.hide(),t=document.createElement("span"),(!1 in t||!("ondragleave"in t&&"ondragover"in t&&"ondrop"in t))&&p.parent().empty(),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera\ Mini/i.test(navigator.userAgent)&&p.parent().empty(),f.click(function(t){t.preventDefault(),w||(h.empty(),c.empty().text("Grabbing the image from the server, this may take a few seconds."),w=!0,v=!1,p.hide(),e(),g.hasClass("disabled")||g.toggleClass("disabled"),f.toggleClass("disabled"),m.toggleClass("disabled"))}),n.change(function(e){w?e.preventDefault():(h.empty(),c.empty(),w=!0,v=!1,p.hide(),i(e.target.files[0]),g.hasClass("disabled")||g.toggleClass("disabled"),f.toggleClass("disabled"),m.toggleClass("disabled"))}),g.click(function(e){e.preventDefault(),v&&(v=!1,d("HCV_genie_"+(new Date).toLocaleString().replace(/[\/\,\s\:]+/g,"_")))}),p.on("dragover",function(e){return e.preventDefault(),e.stopPropagation(),a||w||(p.addClass("hover"),a=!0),!1}),p.on("dragleave",function(e){return e.preventDefault(),e.stopPropagation(),p.removeClass("hover"),a=!1,!1}),p.on("drop",function(e){e.preventDefault(),e.stopPropagation(),p.removeClass("hover"),a=!1,w||(h.empty(),c.empty(),g.hasClass("disabled")||g.toggleClass("disabled"),f.toggleClass("disabled"),m.toggleClass("disabled"),w=!0,v=!1,p.hide(),i(e.originalEvent.dataTransfer.files[0]))})}(),function(){u('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=u(e.target).attr("href");window.location.hash="#home"!==t?t:"",window.scrollTo(0,0)})}(),window.onload=function(){window.scrollTo(0,0),window.location.hash&&u('a[href="'+window.location.hash+'"]').click()}}();